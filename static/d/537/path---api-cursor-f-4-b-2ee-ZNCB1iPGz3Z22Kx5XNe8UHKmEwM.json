{"data":{"site":{"siteMetadata":{"title":"node-postgres","docsLocation":"https://github.com/hasura/gatsby-gitbook-boilerplate/tree/master/content"}},"mdx":{"fields":{"id":"4659d36c-1835-547b-b934-cc073889335b","title":"Cursor","slug":"/api/cursor"},"code":{"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"Cursor API\"), mdx(\"p\", null, \"A cursor can be used to efficiently read through large result sets without loading the entire result-set into memory ahead of time.  It's useful to simulate a 'streaming' style read of data, or exit early from a large result set.  The cursor is passed to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"client.query\"), \" and is dispatched internally in a way very similar to how normal queries are sent, but the API it presents for consuming the result set is different.\"), mdx(\"h2\", null, \"install\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"$ npm install pg pg-cursor\\n\")), mdx(\"h2\", null, mdx(\"inlineCode\", {\n    parentName: \"h2\"\n  }, \"new Cursor(text: String, values: Any[])\")), mdx(\"p\", null, \"Instantiates a new Cursor.  A cursor is an instance of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Submittable\"), \" and should be passed directly to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"client.query\"), \" method.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const { Pool } = require('pg')\\nconst Cursor = require('pg-cursor')\\n\\nconst pool = new Pool()\\nconst client = await pool.connect()\\nconst text = 'SELECT * FROM my_large_table WHERE something > $1'\\nconst values = [10]\\n\\nconst cursor = client.query(new Cursor(text, values))\\n\\ncursor.read(100, function (err, rows) => {\\n  cursor.close(() => {\\n    client.release()\\n  })\\n})\\n\")), mdx(\"h2\", null, mdx(\"inlineCode\", {\n    parentName: \"h2\"\n  }, \"cursor.read(rowCount: Number, callback: (err: Error, rows: Row[], result: pg.Result) => void) => void\")), mdx(\"p\", null, \"Read \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"rowCount\"), \" rows from the cursor instance. The callback will be called when the rows are available, loaded into memory, parsed, and converted to JavaScript types.\"), mdx(\"p\", null, \"If the cursor has read to the end of the result sets all subsequent calls to cursor#read will return a 0 length array of rows.  Calling \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"read\"), \" on a cursor that has read to the end.\"), mdx(\"p\", null, \"Here is an example of reading to the end of a cursor:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const { Pool } = require('pg')\\nconst Cursor = require('pg-cursor')\\n\\nconst pool = new Pool()\\nconst client = await pool.connect()\\nconst cursor = client.query(new Cursor('select * from generate_series(0, 5)'))\\ncursor.read(100, (err, rows) => {\\n  if (err) {\\n    throw err;\\n  }\\n  assert(rows.length == 6)\\n  cursor.read(100, (err, res) => {\\n    assert(rows.length == 0)\\n  })\\n})\\n\")), mdx(\"h3\", null, mdx(\"inlineCode\", {\n    parentName: \"h3\"\n  }, \"cursor.close(callback: (err: Error) => void) => void\")), mdx(\"p\", null, \"Used to close the cursor early. If you want to stop reading from the cursor before you get all of the rows returned, call this.\"));\n}\n;\nMDXContent.isMDXComponent = true;"},"tableOfContents":{"items":[{"url":"#cursor-api","title":"Cursor API","items":[{"url":"#install","title":"install"},{"url":"#new-cursortext-string-values-any","title":"new Cursor(text: String, values: Any[])"},{"url":"#cursorreadrowcount-number-callback-err-error-rows-row-result-pgresult--void--void","title":"cursor.read(rowCount: Number, callback: (err: Error, rows: Row[], result: pg.Result) => void) => void","items":[{"url":"#cursorclosecallback-err-error--void--void","title":"cursor.close(callback: (err: Error) => void) => void"}]}]}]},"parent":{"__typename":"File","relativePath":"api/cursor.md"},"frontmatter":{"metaTitle":null,"metaDescription":null}},"allMdx":{"edges":[{"node":{"fields":{"slug":"/announcements","title":"Announcements"}}},{"node":{"fields":{"slug":"/","title":"Welcome"}}},{"node":{"fields":{"slug":"/api/query-stream","title":"Query Stream"}}},{"node":{"fields":{"slug":"/api/cursor","title":"Cursor"}}},{"node":{"fields":{"slug":"/api/types","title":"Types"}}},{"node":{"fields":{"slug":"/api/result","title":"Result"}}},{"node":{"fields":{"slug":"/api/query","title":"Query"}}},{"node":{"fields":{"slug":"/guides/project-structure","title":"Project Structure"}}},{"node":{"fields":{"slug":"/guides/async-express","title":"Async Express"}}},{"node":{"fields":{"slug":"/guides/upgrading","title":"Upgrading"}}},{"node":{"fields":{"slug":"/features/5-types","title":"Data Types"}}},{"node":{"fields":{"slug":"/features/1-connecting","title":"Connecting"}}},{"node":{"fields":{"slug":"/features/2-queries","title":"Queries"}}},{"node":{"fields":{"slug":"/features/3-pooling","title":"Pooling"}}},{"node":{"fields":{"slug":"/features/4-transactions","title":"Transactions"}}},{"node":{"fields":{"slug":"/features/7-native","title":"Native Bindings"}}},{"node":{"fields":null}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"4659d36c-1835-547b-b934-cc073889335b"}}